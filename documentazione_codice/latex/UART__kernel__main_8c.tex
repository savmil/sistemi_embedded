\hypertarget{UART__kernel__main_8c}{}\section{/media/saverio/\+O\+S/\+Users/\+Saverio/\+Desktop/\+S\+E/git/\+Michele/\+F\+P\+G\+A/\+U\+A\+R\+T/\+Driver/\+Con\+\_\+interrupt/\+K\+E\+R\+N\+E\+L\+\_\+\+M\+O\+D\+E/\+U\+A\+R\+T\+\_\+kernel\+\_\+main.c File Reference}
\label{UART__kernel__main_8c}\index{/media/saverio/\+O\+S/\+Users/\+Saverio/\+Desktop/\+S\+E/git/\+Michele/\+F\+P\+G\+A/\+U\+A\+R\+T/\+Driver/\+Con\+\_\+interrupt/\+K\+E\+R\+N\+E\+L\+\_\+\+M\+O\+D\+E/\+U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{/media/saverio/\+O\+S/\+Users/\+Saverio/\+Desktop/\+S\+E/git/\+Michele/\+F\+P\+G\+A/\+U\+A\+R\+T/\+Driver/\+Con\+\_\+interrupt/\+K\+E\+R\+N\+E\+L\+\_\+\+M\+O\+D\+E/\+U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}}


Inizializza il driver kernel ed espone le funzionalità del modulo.  




\subsection{Detailed Description}
Inizializza il driver kernel ed espone le funzionalità del modulo. 



\subsection{Function Documentation}
\mbox{\Hypertarget{UART__kernel__main_8c_ad0387b8483398a4369c6f42d62b2e90d}\label{UART__kernel__main_8c_ad0387b8483398a4369c6f42d62b2e90d}} 
\index{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}!module\+\_\+platform\+\_\+driver@{module\+\_\+platform\+\_\+driver}}
\index{module\+\_\+platform\+\_\+driver@{module\+\_\+platform\+\_\+driver}!U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}}
\subsubsection{\texorpdfstring{module\+\_\+platform\+\_\+driver()}{module\_platform\_driver()}}
{\footnotesize\ttfamily module\+\_\+platform\+\_\+driver (\begin{DoxyParamCaption}\item[{\hyperlink{UART__kernel__main_8c_a614fdbf74973ebb70eff2b4474a81b62}{U\+A\+R\+T\+\_\+driver}}]{ }\end{DoxyParamCaption})}



la macro \hyperlink{UART__kernel__main_8c_ad0387b8483398a4369c6f42d62b2e90d}{module\+\_\+platform\+\_\+driver()} prende in input la struttura platform\+\_\+driver ed implementa le funzioni module\+\_\+init() e module\+\_\+close() standard, chiamate quando il modulo viene caricato o rimosso dal kernel. 


\begin{DoxyParams}{Parameters}
{\em U\+A\+R\+T\+\_\+driver} & struttura platform\+\_\+driver associata al driver \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{UART__kernel__main_8c_a2cb5fe17bc765d85998671e685c224d6}\label{UART__kernel__main_8c_a2cb5fe17bc765d85998671e685c224d6}} 
\index{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}!U\+A\+R\+T\+\_\+irq\+\_\+handler@{U\+A\+R\+T\+\_\+irq\+\_\+handler}}
\index{U\+A\+R\+T\+\_\+irq\+\_\+handler@{U\+A\+R\+T\+\_\+irq\+\_\+handler}!U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}}
\subsubsection{\texorpdfstring{U\+A\+R\+T\+\_\+irq\+\_\+handler()}{UART\_irq\_handler()}}
{\footnotesize\ttfamily static irqreturn\+\_\+t U\+A\+R\+T\+\_\+irq\+\_\+handler (\begin{DoxyParamCaption}\item[{int}]{irq,  }\item[{struct pt\+\_\+regs $\ast$}]{regs }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Interrupt-\/handler. 


\begin{DoxyParams}{Parameters}
{\em irq} & Interrupt-\/number a cui il device è connesso \\
\hline
{\em regs} & registri sullo stack alla system call entry\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em I\+R\+Q\+\_\+\+H\+A\+N\+D\+L\+ED} & dopo aver servito l\textquotesingle{}interruzione \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{UART__kernel__main_8c_a0c5a540d5446f96fc782546dbcbc2bea}\label{UART__kernel__main_8c_a0c5a540d5446f96fc782546dbcbc2bea}} 
\index{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}!U\+A\+R\+T\+\_\+llseek@{U\+A\+R\+T\+\_\+llseek}}
\index{U\+A\+R\+T\+\_\+llseek@{U\+A\+R\+T\+\_\+llseek}!U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}}
\subsubsection{\texorpdfstring{U\+A\+R\+T\+\_\+llseek()}{UART\_llseek()}}
{\footnotesize\ttfamily static loff\+\_\+t U\+A\+R\+T\+\_\+llseek (\begin{DoxyParamCaption}\item[{struct file $\ast$}]{file\+\_\+ptr,  }\item[{loff\+\_\+t}]{off,  }\item[{int}]{whence }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Implementa le system-\/call lseek() e llseek(). 


\begin{DoxyParams}{Parameters}
{\em file\+\_\+ptr} & puntatore al descrittore file del device \\
\hline
{\em off} & offset da aggiungere al parametro whence per il posizionamento \\
\hline
{\em whence} & può assumere i valori S\+E\+E\+K\+\_\+\+S\+ET, S\+E\+E\+K\+\_\+\+C\+UR o S\+E\+E\+K\+\_\+\+E\+ND per specificare rispettivamente il riferimento dall\textquotesingle{}inizio file, dalla posizione corrente o dalla fine.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Nuova posizione della \char`\"{}testina\char`\"{} di lettura/scrittura 
\end{DoxyReturn}
\mbox{\Hypertarget{UART__kernel__main_8c_ad281ac9e54472abea9d9aaae3c61e6e9}\label{UART__kernel__main_8c_ad281ac9e54472abea9d9aaae3c61e6e9}} 
\index{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}!U\+A\+R\+T\+\_\+open@{U\+A\+R\+T\+\_\+open}}
\index{U\+A\+R\+T\+\_\+open@{U\+A\+R\+T\+\_\+open}!U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}}
\subsubsection{\texorpdfstring{U\+A\+R\+T\+\_\+open()}{UART\_open()}}
{\footnotesize\ttfamily static int U\+A\+R\+T\+\_\+open (\begin{DoxyParamCaption}\item[{struct inode $\ast$}]{inode,  }\item[{struct file $\ast$}]{file\+\_\+ptr }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Invocata all\textquotesingle{}apertura del file corrispondente al device. 


\begin{DoxyRetVals}{Return values}
{\em 0} & se non si verifica nessun errore \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{UART__kernel__main_8c_ac14a568befd982fc0c30d5b24af61501}\label{UART__kernel__main_8c_ac14a568befd982fc0c30d5b24af61501}} 
\index{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}!U\+A\+R\+T\+\_\+poll@{U\+A\+R\+T\+\_\+poll}}
\index{U\+A\+R\+T\+\_\+poll@{U\+A\+R\+T\+\_\+poll}!U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}}
\subsubsection{\texorpdfstring{U\+A\+R\+T\+\_\+poll()}{UART\_poll()}}
{\footnotesize\ttfamily static unsigned int U\+A\+R\+T\+\_\+poll (\begin{DoxyParamCaption}\item[{struct file $\ast$}]{file\+\_\+ptr,  }\item[{struct poll\+\_\+table\+\_\+struct $\ast$}]{wait }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Verifica che le operazioni di lettura risultino non-\/bloccanti. 


\begin{DoxyParams}{Parameters}
{\em device} & puntatore a struttura \hyperlink{structUART}{U\+A\+RT}, che si riferisce al device su cui operare \\
\hline
{\em file\+\_\+ptr} & puntatore al descrittore file del device \\
\hline
{\em wait} & puntatore alla struttura poll\+\_\+table\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
maschera di bit che indica se sia possibile effettuare operazioni di lettura non bloccanti.
\end{DoxyReturn}
Back-\/end di tre diverse sys-\/calls\+: poll, epoll e select, \mbox{\Hypertarget{UART__kernel__main_8c_abc41b10649682af308a118dd9316c037}\label{UART__kernel__main_8c_abc41b10649682af308a118dd9316c037}} 
\index{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}!U\+A\+R\+T\+\_\+read@{U\+A\+R\+T\+\_\+read}}
\index{U\+A\+R\+T\+\_\+read@{U\+A\+R\+T\+\_\+read}!U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}}
\subsubsection{\texorpdfstring{U\+A\+R\+T\+\_\+read()}{UART\_read()}}
{\footnotesize\ttfamily static ssize\+\_\+t U\+A\+R\+T\+\_\+read (\begin{DoxyParamCaption}\item[{struct file $\ast$}]{file\+\_\+ptr,  }\item[{char $\ast$}]{buf,  }\item[{size\+\_\+t}]{count,  }\item[{loff\+\_\+t $\ast$}]{off }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Legge dati dal device. 


\begin{DoxyParams}{Parameters}
{\em file\+\_\+ptr} & puntatore al descrittore file del device \\
\hline
{\em buf} & puntatore all\textquotesingle{}area di memoria dove verranno copiati i count bytes letti \\
\hline
{\em count} & numeri di bytes da trasferire \\
\hline
{\em off} & long offset type che indica la posizione alla quale si sta effettuando l\textquotesingle{}accesso\\
\hline
\end{DoxyParams}
\begin{DoxyNote}{Note}
l\textquotesingle{}aggiunta del flag O\+\_\+\+N\+O\+N\+B\+L\+O\+CK all\textquotesingle{}apertura del file descriptor associato al device farà sì che il processo chiamante non verrà bloccato se alla chiamata di una lettura non troverà dati disponibili 
\end{DoxyNote}
\mbox{\Hypertarget{UART__kernel__main_8c_a3e3ef8879eafe1a898efa42536cb903e}\label{UART__kernel__main_8c_a3e3ef8879eafe1a898efa42536cb903e}} 
\index{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}!U\+A\+R\+T\+\_\+release@{U\+A\+R\+T\+\_\+release}}
\index{U\+A\+R\+T\+\_\+release@{U\+A\+R\+T\+\_\+release}!U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}}
\subsubsection{\texorpdfstring{U\+A\+R\+T\+\_\+release()}{UART\_release()}}
{\footnotesize\ttfamily static int U\+A\+R\+T\+\_\+release (\begin{DoxyParamCaption}\item[{struct inode $\ast$}]{inode,  }\item[{struct file $\ast$}]{file\+\_\+ptr }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Invocata alla chiusura del file corrispondente al device. 


\begin{DoxyParams}{Parameters}
{\em inode} & struttura dati sul file system che archivia e descrive attributi base su file, directory o qualsiasi altro oggetto \\
\hline
{\em file\+\_\+ptr} & puntatore al descrittore file del device\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & se non si verifica nessun errore \\
\hline
\end{DoxyRetVals}
\mbox{\Hypertarget{UART__kernel__main_8c_a25c6ac5c7b986f6824879b875996178c}\label{UART__kernel__main_8c_a25c6ac5c7b986f6824879b875996178c}} 
\index{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}!U\+A\+R\+T\+\_\+remove@{U\+A\+R\+T\+\_\+remove}}
\index{U\+A\+R\+T\+\_\+remove@{U\+A\+R\+T\+\_\+remove}!U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}}
\subsubsection{\texorpdfstring{U\+A\+R\+T\+\_\+remove()}{UART\_remove()}}
{\footnotesize\ttfamily static int U\+A\+R\+T\+\_\+remove (\begin{DoxyParamCaption}\item[{struct platform\+\_\+device $\ast$}]{pdev }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

Viene chiamata automaticamente alla rimozione del modulo.


\begin{DoxyParams}{Parameters}
{\em pdev} & \\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em 0} & se non si verifica nessun errore\\
\hline
\end{DoxyRetVals}
Dealloca tutta la memoria utilizzata dal driver, de-\/inizializzando il device e disattivando gli interrupt per il device, effettuando tutte le operazioni inverse della funzione \hyperlink{UART__kernel__main_8c_a9dc0e4187f4bf823ae23f86d943a7d64}{U\+A\+R\+T\+\_\+probe()}. \mbox{\Hypertarget{UART__kernel__main_8c_a698b0d23bcc48e9b338131fbf343b28a}\label{UART__kernel__main_8c_a698b0d23bcc48e9b338131fbf343b28a}} 
\index{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}!U\+A\+R\+T\+\_\+write@{U\+A\+R\+T\+\_\+write}}
\index{U\+A\+R\+T\+\_\+write@{U\+A\+R\+T\+\_\+write}!U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}}
\subsubsection{\texorpdfstring{U\+A\+R\+T\+\_\+write()}{UART\_write()}}
{\footnotesize\ttfamily static ssize\+\_\+t U\+A\+R\+T\+\_\+write (\begin{DoxyParamCaption}\item[{struct file $\ast$}]{file\+\_\+ptr,  }\item[{const char \+\_\+\+\_\+user $\ast$}]{buf,  }\item[{size\+\_\+t}]{count,  }\item[{loff\+\_\+t $\ast$}]{off }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Invia dati al device. 


\begin{DoxyParams}{Parameters}
{\em file\+\_\+ptr} & puntatore al descrittore file del device \\
\hline
{\em buf} & puntatore all\textquotesingle{}area di memoria dalla quale verranno copiati i count bytes \\
\hline
{\em count} & numeri di bytes da trasferire \\
\hline
{\em off} & long offset type che indica la posizione alla quale si sta effettuando l\textquotesingle{}accesso \\
\hline
\end{DoxyParams}


\subsection{Variable Documentation}
\mbox{\Hypertarget{UART__kernel__main_8c_a422309d376dbdba198b2722c5a2ecdef}\label{UART__kernel__main_8c_a422309d376dbdba198b2722c5a2ecdef}} 
\index{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}!\+\_\+\+\_\+test\+\_\+int\+\_\+driver\+\_\+id@{\+\_\+\+\_\+test\+\_\+int\+\_\+driver\+\_\+id}}
\index{\+\_\+\+\_\+test\+\_\+int\+\_\+driver\+\_\+id@{\+\_\+\+\_\+test\+\_\+int\+\_\+driver\+\_\+id}!U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+test\+\_\+int\+\_\+driver\+\_\+id}{\_\_test\_int\_driver\_id}}
{\footnotesize\ttfamily const struct of\+\_\+device\+\_\+id \+\_\+\+\_\+test\+\_\+int\+\_\+driver\+\_\+id\mbox{[}$\,$\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}

{\bfseries Initial value\+:}
\begin{DoxyCode}
=\{
    \{.compatible = \textcolor{stringliteral}{"xlnx,UART-1.0"}\},
    \{\}
\}
\end{DoxyCode}


Identifica il device all\textquotesingle{}interno del device tree. 

\mbox{\Hypertarget{UART__kernel__main_8c_a614fdbf74973ebb70eff2b4474a81b62}\label{UART__kernel__main_8c_a614fdbf74973ebb70eff2b4474a81b62}} 
\index{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}!U\+A\+R\+T\+\_\+driver@{U\+A\+R\+T\+\_\+driver}}
\index{U\+A\+R\+T\+\_\+driver@{U\+A\+R\+T\+\_\+driver}!U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}}
\subsubsection{\texorpdfstring{U\+A\+R\+T\+\_\+driver}{UART\_driver}}
{\footnotesize\ttfamily struct platform\+\_\+driver U\+A\+R\+T\+\_\+driver\hspace{0.3cm}{\ttfamily [static]}}

{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    .driver = \{
                .name = DRIVER\_NAME,
                .owner = THIS\_MODULE,
                .of\_match\_table = of\_match\_ptr(\hyperlink{UART__kernel__main_8c_a422309d376dbdba198b2722c5a2ecdef}{\_\_test\_int\_driver\_id}),
        \},  
    .probe = \hyperlink{UART__kernel__main_8c_a9dc0e4187f4bf823ae23f86d943a7d64}{UART\_probe},
    .remove = \hyperlink{UART__kernel__main_8c_a25c6ac5c7b986f6824879b875996178c}{UART\_remove}    
\}
\end{DoxyCode}


Definisce le funzioni probe() e remove() da chiamare al caricamento del driver. 

\mbox{\Hypertarget{UART__kernel__main_8c_a3b86d791a13e444c9ea2b580e56b6d58}\label{UART__kernel__main_8c_a3b86d791a13e444c9ea2b580e56b6d58}} 
\index{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}!U\+A\+R\+T\+\_\+fops@{U\+A\+R\+T\+\_\+fops}}
\index{U\+A\+R\+T\+\_\+fops@{U\+A\+R\+T\+\_\+fops}!U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c@{U\+A\+R\+T\+\_\+kernel\+\_\+main.\+c}}
\subsubsection{\texorpdfstring{U\+A\+R\+T\+\_\+fops}{UART\_fops}}
{\footnotesize\ttfamily struct file\+\_\+operations U\+A\+R\+T\+\_\+fops\hspace{0.3cm}{\ttfamily [static]}}

{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
        .owner      = THIS\_MODULE,
        .llseek     = \hyperlink{UART__kernel__main_8c_a0c5a540d5446f96fc782546dbcbc2bea}{UART\_llseek},
        .read       = \hyperlink{UART__kernel__main_8c_abc41b10649682af308a118dd9316c037}{UART\_read},
        .write      = \hyperlink{UART__kernel__main_8c_a698b0d23bcc48e9b338131fbf343b28a}{UART\_write},
        .poll       = \hyperlink{UART__kernel__main_8c_ac14a568befd982fc0c30d5b24af61501}{UART\_poll},
        .open       = \hyperlink{UART__kernel__main_8c_ad281ac9e54472abea9d9aaae3c61e6e9}{UART\_open},
        .release    = \hyperlink{UART__kernel__main_8c_a3e3ef8879eafe1a898efa42536cb903e}{UART\_release}
\}
\end{DoxyCode}


Struttura che specifica le funzioni che agiscono sul device. 

